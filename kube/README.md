# New Jupyter-vcdat Release Steps:

When making a new jupyter-vcdat official release, make sure master contains 
all the latest updates and the package.json version has been updated to the
new version number. Check all documentation has been updated to reflect new
release number and features. Go to https://github.com/CDAT/jupyter-vcdat/releases
and make sure the release has been tagged with latest commit.
Once everything has been done and all tests have passed, then jupyter-vcdat is
ready to publish to npm and docker hub. Follow the steps below to make official
published versions.

## Convert nightly to latest release
Nightly docker images, conda and npm packages are generated by each commit to
master. Therefore, in order to do an official release, all that's needed is to
remove the nightly tag from the latest packages in conda, npm and docker.

## Convert latest nightly package to official:
- Get the version of the latest nightly npm package (the one to make official)
```bash
npm view jupyter-vcdat dist-tags #Get the latest nightly version number
npm dist-tag add jupyter-vcdat@<nightly-version> latest
```

## Convert latest nightly docker image to official latest
- Create a tag for the nightly image to latest
```bash
docker pull cdat/vcdat:nightly #Get the latest docker nightly image
docker image tag cdat/vcdat:nightly cdat/vcdat:latest #Set as the latest image
docker push cdat/vcdat:latest #Push to docker hub
```

## For Conda package
- Go to anaconda cloud and edit the label of the nightly package, so that it
includes the latest official label: https://anaconda.org/cdat/jupyter-vcdat/files
Find the latests stable file and click 'labels'. Then enter new version label.

# Manual Publish steps:
Note: The steps below are for manually publishing jupyter-vcdat to npm and docker hub, 
however every commit to master will automaticaly publish as the nightly tag
(after tests pass), so these steps are only if you need to run it manually.

## NPM Publish steps:

- Go to jupyter-vcdat repo and checkout master branch:
```bash
cd vcdat/repo/path
git checkout master
git pull #Pull latest changes from master
```

- Publish to npm:
Note: Make sure the package.json contains the correct official version being published
before running this step.
```bash
npm login
npm install
npm publish
```
## Docker Image Build and publish:

- Build docker image:
```bash
#Do this within the kube directory
docker build -t cdat/vcdat:<new version> .
```

- Test the docker image runs properly:
```bash
docker run -p 9000:9000 -v /<Path to directory to use in testing>/:\
/home/jovyan/testing/ -it cdat/vcdat:<new version> jupyter-lab --port=9000
```
Note: Within browser, go to: localhost:9000, and enter the jupyterlab token from the console into the token field. Then you should see jupyter-vcdat in browser

- After test is successful and image is running properly, publish to docker hub:
```bash
docker push cdat/vcdat:<new version>
docker image tag cdat/vcdat:<new version> cdat/vcdat:latest
docker push cdat/vcdat:latest
```
